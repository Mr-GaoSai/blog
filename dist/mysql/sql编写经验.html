<!DOCTYPE html>
<html>
<head>

    <meta http-equiv="context-type" content="text/html" charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" type="image/png" href="/assets/icon.png">
    <link rel="apple-touch-icon" type="image/png" href="/assets/icon.png">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" type="text/css" href="/assets/md.css">

    <title>高赛's blog</title>
</head>

<body>

<h1>SQL 经验</h1>

<p></p>

<h3>负向查询不能使用索引</h3>

<p>
<code>sql
select name from user where id not in (1,3,4);
</code>
应该修改为:

<code>
select name from user where id in (2,5,6);
</code>
</p>

<h3>前导模糊查询不能使用索引</h3>

<p>如:

<code>sql
select name from user where name like '%zhangsan'
</code>

非前导则可以:
<code>sql
select name from user where name like 'zhangsan%'
</code>
建议可以考虑使用 <code>Lucene</code> 等全文索引工具来代替频繁的模糊查询。
</p>

<h3>数据区分不明显的不建议创建索引</h3>

<p>
如 user 表中的性别字段，可以明显区分的才建议创建索引，如身份证等字段。
</p>

<h3>字段的默认值不要为 null</h3>

<p>这样会带来和预期不一致的查询结果。
</p>

<h3>在字段上进行计算不能命中索引</h3>

<p>
<code>sql
select name from user where FROM_UNIXTIME(create_time) &lt; CURDATE();
</code>

应该修改为:

<code>sql
select name from user where create_time &lt; FROM_UNIXTIME(CURDATE());
</code>
</p>

<h3>最左前缀问题</h3>

<p>
如果给 user 表中的 username pwd 字段创建了复合索引那么使用以下SQL 都是可以命中索引:

<code>sql
select username from user where username='zhangsan' and pwd ='axsedf1sd'

select username from user where pwd ='axsedf1sd' and username='zhangsan'

select username from user where username='zhangsan'
</code>

但是使用

<code>sql
select username from user where pwd ='axsedf1sd'
</code>
是不能命中索引的。
</p>

<h3>如果明确知道只有一条记录返回</h3>

<p>
<code>sql
select name from user where username='zhangsan' limit 1
</code>
可以提高效率，可以让数据库停止游标移动。
</p>

<h3>不要让数据库帮我们做强制类型转换</h3>

<p>
<code>sql
select name from user where telno=18722222222
</code>
这样虽然可以查出数据，但是会导致全表扫描。

需要修改为
<code>
select name from user where telno='18722222222'
</code>
</p>

<h3>如果需要进行 join 的字段两表的字段类型要相同</h3>

<p>
不然也不会命中索引。
</p>

<h3>声明</h3>

<p>部分内容来源于<a href="https://github.com/crossoverJie/Java-Interview/blob/master/MD/SQL-optimization.md">crossoverJie/Java-Interview</a></p>


</body>
</html>
