<!DOCTYPE html>
<html>
<head>

    <meta http-equiv="context-type" content="text/html" charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" type="image/png" href="/assets/icon.png">
    <link rel="apple-touch-icon" type="image/png" href="/assets/icon.png">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <link rel="stylesheet" type="text/css" href="/assets/md.css">

    <title>高赛's blog</title>
</head>

<body>

<p></p>

<h1>sql优化</h1>

<p></p>

<h3>1. 建立合适的索引</h3>

<p>建立索引需要遵循最左索引原则。

什么是索引？索引是帮助mysql高效获取数据的数据结构。

过多的索引导致插入时耗时严重，但是查询时迅速。因此建立合适的索引很重要。

建立索引操作形式为:create [unique] index index_user_name on t_user(name)

什么情况下需要建索引?

主键自动建索引,频繁查询字段建索引,查询中与其他表关联的字段建索引,排序字段建索引.
对于频繁更新的字段不适合建索引,where条件始终用不到字段不创建索引,表记录太少不建,经常增删改的表不建,重复率高的字段不建索引（比如性别）
</p>

<h3>2. 慢查询开启&ndash;&gt;查看时间长的sql语句，进行优化</h3>

<p>
开启慢查询命令：set global slow_query_log=on;。 重启后失效

慢查询，多长时间算慢，如何查看：show variables like ‘long_query_time%’;

设置慢查询阙值：set global long_query_time=3;

<strong><em>explain</em></strong> 可查看sql使用的索引和推测执行过程（复杂）

<strong><em>explain extended + sql</em></strong> 可将mysql系统优化的sql加入warning中

<strong><em>show warning</em></strong>可查看warning中的sql语句。
</p>

<h3>3. 查看历史sql性能</h3>

<p>
历史sql语句，可以看到sql执行时间，损耗cpu多少

show profile进行调优。

开启： set global profiling =on;

查看状态：show variables like ‘profiling’;

调用show profile;

修改后查看发现未改变，退出当前会话，重新进入发现改变。

mysql -h localhost -u root -p 123456 -P 3306

结果显示
mysql&gt; show profiles;

+———-+————+———————————+

| Query_ID | Duration | Query |

+———-+————+———————————+

| 1 | 0.00113950 | show variables like ‘profiling’ |

| 2 | 0.25660775 | select from t_user |

查看某条命令详细的执行情况：show profile cpu,block io for query +id;

比如：show profile cpu,block io for query 1;
</p>

<h3>4.实例分享</h3>

<p>
<a href="http://www.cnblogs.com/tangyanbo/p/4462734.html">http://www.cnblogs.com/tangyanbo/p/4462734.html</a>

网上某位大牛的优化记录过程

</p>


</body>
</html>
