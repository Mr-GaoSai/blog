## volatile类型修饰符

> 时间：2017/08/16
> 
> 作者：Mr-GaoSai
> 
> 引用：http://www.importnew.com/18126.html

### jvm的一个知识点

多线程读取共享变量资源。每个线程会先将资源加到自己所在内存缓存起来，下次读取的时候直接从缓存中拿，提高了速度性能。然后出现的问题是如果一个线程修改了此变量，那么另一个线程已经将此变量加入了缓存，那么就读取脏数据。

### volatile
这个修饰符，就保证每次访问volatile修饰的变量时不会读取缓存中的变量。

保证了读取都是最新的。

### ++i多线程不安全
共享变量i进行了volatile修饰，但是++i在多线程下仍然是不安全的。因为++i等价于i=i+1;如果两个线程同时读取，同时修改，这样就导致少加个1。这种情况就得加锁。

### 面试题
```java
//共享变量
boolean stop = false;
//线程1
while(!stop){
    doSomething();
}
//线程2
stop = true;
```
上面代码可能会导致线程1无法结束。循环一直执行。

```java
//共享变量
volatile boolean stop = false;
//线程1
while(!stop){
    doSomething();
}
//线程2
stop = true;
```
这样while循环的表达式每次读取都是最新的，这样就不会发生死循环了。

### volatile使用场景
1）对变量的写操作不依赖于当前值

2）该变量没有包含在具有其他变量的不变式中